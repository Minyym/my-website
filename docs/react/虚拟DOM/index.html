<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">虚拟DOM | My Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://Minyym.github.io/my-website/docs/react/虚拟DOM"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="虚拟DOM | My Site"><meta data-react-helmet="true" name="description" content="虚拟DOM"><meta data-react-helmet="true" property="og:description" content="虚拟DOM"><link data-react-helmet="true" rel="shortcut icon" href="/my-website/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://Minyym.github.io/my-website/docs/react/虚拟DOM"><link data-react-helmet="true" rel="alternate" href="https://Minyym.github.io/my-website/docs/react/虚拟DOM" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://Minyym.github.io/my-website/docs/react/虚拟DOM" hreflang="x-default"><link rel="stylesheet" href="/my-website/assets/css/styles.6f0efc76.css">
<link rel="preload" href="/my-website/assets/js/runtime~main.e0efcf5b.js" as="script">
<link rel="preload" href="/my-website/assets/js/main.0b8336bd.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/my-website/"><b class="navbar__title">xiaojingyu</b></a><a class="navbar__item navbar__link navbar__link--active" href="/my-website/docs/JS基础/new">JS</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Minyym/my-website" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button class="clean-btn backToTopButton_i9tI" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">CSS&amp;HTML</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ES</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">GIT</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">JS基础</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">TS</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">babel</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">npm&amp;node</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">react</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/react/api汇总">api汇总</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/react/hook">hook</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/my-website/docs/react/虚拟DOM">虚拟DOM</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/react/进阶">进阶</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/my-website/docs/react/面试题">面试题</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">skills</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">webpack</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">前端基建</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">小程序</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">浏览器</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">算法</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">计算机组成原理</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">设计模式</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">面试</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>虚拟DOM</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="虚拟dom"></a>虚拟DOM<a class="hash-link" href="#虚拟dom" title="Direct link to heading">#</a></h2><ul><li><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="什么是虚拟dom"></a>什么是虚拟DOM<a class="hash-link" href="#什么是虚拟dom" title="Direct link to heading">#</a></h3><ul><li>一个能代表DOM树的对象，通常包含标签名、标签上的属性、事件监听和子元素们、以及其他属性</li></ul></li><li><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="虚拟dom的优点"></a>虚拟DOM的优点<a class="hash-link" href="#虚拟dom的优点" title="Direct link to heading">#</a></h3><ul><li><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="提高开发效率"></a>提高开发效率<a class="hash-link" href="#提高开发效率" title="Direct link to heading">#</a></h4><ul><li>使用<code>JavaScript 或</code> <code>jQuery</code> ，我们在编写应用程序时，还需关注如何去更新<code>DOM</code>。</li><li>使用<code>React</code>，因为有数据驱动视图，你只需要告诉<code>React</code>你想让视图处于什么状态，<code>React</code>则通过<code>VitrualDom</code>确保<code>DOM</code>与该状态相匹配。你不必自己去完成属性操作、事件处理、<code>DOM</code>更新，<code>React</code>会替你完成这一切。</li><li>这让我们<strong>更关注我们的业务逻辑而非<code>DOM</code>操作</strong>，这一点即可大大提升我们的开发效率。</li></ul></li><li><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="跨浏览器兼容"></a>跨浏览器兼容<a class="hash-link" href="#跨浏览器兼容" title="Direct link to heading">#</a></h4><ul><li><code>React</code>基于<code>VitrualDom</code>自己实现了一套自己的事件机制（合成事件），自己模拟了事件冒泡和捕获的过程，采用了事件代理，批量更新等方法，<strong>抹平了各个浏览器的事件兼容性问题</strong>。</li></ul></li><li><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_y2LR" id="跨平台兼容"></a>跨平台兼容<a class="hash-link" href="#跨平台兼容" title="Direct link to heading">#</a></h4><ul><li><code>VitrualDom</code>为<code>React</code>带来了跨平台渲染的能力，<strong>虚拟DOM其实就是一层抽象层，可以让我们写的代码在多端表现一致</strong></li><li>以<code>React Native</code>为例子。<code>React</code>根据<code>VitrualDom</code>画出相应平台的<code>ui</code>层，只不过不同平台画的姿势不同而已。</li></ul></li><li><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="提高性能"></a>提高性能<a class="hash-link" href="#提高性能" title="Direct link to heading">#</a></h3><ul><li>减少DOM操作<ul><li>虚拟DOM可以将多次操作合并成一个操作，比如添加1000个节点，直接取操作真实DOM，是一个一个的进行添加</li><li>虚拟DOM借助DOM diff算法可以吧多余的操作省掉，比如添加1000个节点，原有990个，10个新增，就会去操作这十个</li></ul></li></ul></li></ul></li><li><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="虚拟dom的缺点"></a>虚拟DOM的缺点<a class="hash-link" href="#虚拟dom的缺点" title="Direct link to heading">#</a></h3><ul><li>需要额外的创建的函数，如createElement，但是可以通过JSX进行简化成XML写法</li><li>过度的依赖的打包工具，（vue-loader babel）React通过babel将JSX转换成createElement形式</li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="diff算法"></a>diff算法<a class="hash-link" href="#diff算法" title="Direct link to heading">#</a></h2><ul><li><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="什么是diff算法"></a>什么是diff算法<a class="hash-link" href="#什么是diff算法" title="Direct link to heading">#</a></h3><ul><li>一种对比新/旧虚拟DOM树的高效算法，能快速计算哪些虚拟DOM树发生了变化，从而只更新局部DOM。</li></ul></li></ul><ul><li>传统的 diff 算法性能开销大，无法满足大规模 DOM 操作需求。 React 通过制定大胆的策略，将性能开销降到最低。</li></ul><ul><li><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="diff-策略"></a>diff 策略<a class="hash-link" href="#diff-策略" title="Direct link to heading">#</a></h3><ul><li><p>Web UI 中 DOM 节点跨层级的移动操作特别少，可以忽略不计。</p></li><li><p>拥有相同类的两个组件将会生成相似的树形结构，拥有不同类的两个组件将会生成不同的树形结构。</p></li><li><p>对于同一层级的一组子节点，它们可以通过唯一 id 进行区分。</p></li></ul></li></ul><ul><li>基于以上三个前提策略，React 分别对 tree diff、component diff 以及 element diff 进行算法优化，事实也证明这三个前提策略是合理且准确的，它保证了整体界面构建的性能。</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="tree-diff"></a>tree diff<a class="hash-link" href="#tree-diff" title="Direct link to heading">#</a></h3><ul><li>基于策略一，React 对树的算法进行了简洁明了的优化，即对树进行分层比较，两棵树只会对同一层次的节点进行比较。</li></ul><ul><li>既然 DOM 节点跨层级的移动操作少到可以忽略不计，针对这一现象，只会对相同颜色方框内的 DOM 节点进行比较，即同一个父节点下的所有子节点。当发现节点已经不存在，则该节点及其子节点会被完全删除掉，不会用于进一步的比较。这样只需要对树进行一次遍历，便能完成整个 DOM 树的比较。</li></ul><p><img src="https://pic1.zhimg.com/80/0c08dbb6b1e0745780de4d208ad51d34_hd.png"></p><ul><li><strong>问题：如果出现了 DOM 节点跨层级的移动操作，性能不好！</strong></li></ul><p><img src="https://pic2.zhimg.com/80/d712a73769688afe1ef1a055391d99ed_hd.png"></p><ul><li>如上图所示：React diff 的执行情况：create A -&gt; create B -&gt; create C -&gt; delete A</li></ul><ul><li>由此可发现，当出现节点跨层级移动时，并不会出现想象中的移动操作，而是以 A 为根节点的树被整个重新创建，这是一种影响 React 性能的操作，因此 React 官方建议不要进行 DOM 节点跨层级的操作。</li></ul><blockquote><p>注意：在开发组件时，保持稳定的 DOM 结构会有助于性能的提升。例如，可以通过 CSS 隐藏或显示节点，而不是真的移除或添加 DOM 节点。</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="component-diff"></a>component diff<a class="hash-link" href="#component-diff" title="Direct link to heading">#</a></h3><ul><li><p>React 是基于组件构建应用的，对于组件间的比较所采取的策略也是简洁高效。</p><ul><li><p>如果是同一类型的组件，按照原策略继续tree diff。</p></li><li><p>如果不是，则将该组件判断为 dirty component，从而替换整个组件下的所有子节点。</p></li><li><p>对于同一类型的组件，有可能其 Virtual DOM 没有任何变化，如果能够确切的知道这点那可以节省大量的 diff 运算时间，因此 React 允许用户通过 shouldComponentUpdate() 来判断该组件是否需要进行 diff。</p></li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="element-diff"></a>element diff<a class="hash-link" href="#element-diff" title="Direct link to heading">#</a></h3><ul><li>如下图，老集合中包含节点：A、B、C、D，更新后的新集合中包含节点：B、A、D、C，此时新老集合进行 diff 差异化对比，发现 B != A，则创建并插入 B 至新集合，删除老集合 A；以此类推，创建并插入 A、D 和 C，删除 B、C 和 D。</li></ul><p><img src="https://pic2.zhimg.com/80/7541670c089b84c59b84e9438e92a8e9_hd.png"></p><ul><li>React 发现这类操作繁琐冗余，因为这些都是相同的节点，但由于位置发生变化，导致需要进行繁杂低效的删除、创建操作，其实只要对这些节点进行位置移动即可。</li></ul><ul><li>针对这一现象，React 提出优化策略：<strong>允许开发者对同一层级的同组子节点，添加唯一 key 进行区分，虽然只是小小的改动，性能上却发生了翻天覆地的变化！</strong></li></ul><ul><li>新老集合所包含的节点，如下图所示，新老集合进行 diff 差异化对比，通过 key 发现新老集合中的节点都是相同的节点，因此无需进行节点删除和创建，只需要将老集合中节点的位置进行移动，更新为新集合中节点的位置，此时 React 给出的 diff 结果为：B、D 不做任何操作，A、C 进行移动操作，即可。</li></ul><p><img src="https://pic4.zhimg.com/80/c0aa97d996de5e7f1069e97ca3accfeb_hd.png"></p><ul><li>问题：如下图所示，若新集合的节点更新为：D、A、B、C，与老集合对比只有 D 节点移动，而 A、B、C 仍然保持原有的顺序，理论上 diff 应该只需对 D 执行移动操作，然而由于 D 在老集合的位置是最大的，造成 D 没有执行移动操作，而是 A、B、C 全部移动到 D 节点后面的现象。</li></ul><p><img src="https://pic1.zhimg.com/80/7b9beae0cf0a5bc8c2e82d00c43d1c90_hd.png"></p><blockquote><p>建议：在开发过程中，尽量减少类似将最后一个节点移动到列表首部的操作，当节点数量过大或更新操作过于频繁时，在一定程度上会影响 React 的渲染性能。</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="总结"></a>总结<a class="hash-link" href="#总结" title="Direct link to heading">#</a></h3><ul><li>React 通过分层求异的策略，对 tree diff 进行算法优化；</li><li>React 通过相同类生成相似树形结构，不同类生成不同树形结构的策略，对 component diff 进行算法优化；</li><li>React 通过设置唯一 key的策略，对 element diff 进行算法优化；</li><li>建议，在开发组件时，保持稳定的 DOM 结构会有助于性能的提升；</li><li>建议，在开发过程中，尽量减少类似将最后一个节点移动到列表首部的操作，当节点数量过大或更新操作过于频繁时，在一定程度上会影响 React 的渲染性能。</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="react-中-keys-的作用是什么"></a>React 中 keys 的作用是什么？<a class="hash-link" href="#react-中-keys-的作用是什么" title="Direct link to heading">#</a></h2><ul><li><p>虚拟 DOM 的 key 的作用?</p><ul><li>简单说: key 是虚拟 DOM 对象的标识, 在更新显示时 key 起着极其重要的作用</li><li>详细说: 当列表数组中的数据发生变化生成新的虚拟 DOM 后, React 进行新旧虚拟 DOM 的 diff 比较<ul><li>key 没有变<ul><li>item 数据没变, 直接使用原来的真实 DOM</li><li>item 数据变了, 对原来的真实 DOM 进行数据更新</li></ul></li><li>key 变了<ul><li>销毁原来的真实 DOM, 根据 item 数据创建新的真实 DOM 显示(即使 item 数据没有变)</li></ul></li></ul></li></ul></li><li><p>key 为 index 的问题</p><ul><li><p>添加/删除/排序 =&gt; 产生没有必要的真实 DOM 更新 ==&gt; 界面效果没问题, 但效率低</p></li><li><p>如果 item 界面还有输入框 =&gt; 产生错误的真实 DOM 更新 ==&gt; 界面有问题</p><ul><li><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI js"><pre tabindex="0" class="prism-code language-js codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">key</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token literal-property property" style="color:#36acaa">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">你</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">key</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token literal-property property" style="color:#36acaa">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">我</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">key</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token literal-property property" style="color:#36acaa">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">他</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token plain">删除第二个（我）</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">key</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token literal-property property" style="color:#36acaa">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">你</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">key</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token literal-property property" style="color:#36acaa">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">我</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">--</span><span class="token operator" style="color:#393A34">--</span><span class="token plain">和我们想的不一样，‘我’没有删除，删除了‘他’</span></span><span class="token-line" style="color:#393A34"><span class="token plain">原因是：我们用了下标做key，删除元素后，下标的值是会变化的（</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">key</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token literal-property property" style="color:#36acaa">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">你</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">key</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token literal-property property" style="color:#36acaa">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">他</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">），diff算法时发现key值是</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">、</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">，算法会认为</span><span class="token number" style="color:#36acaa">1</span><span class="token plain">、</span><span class="token number" style="color:#36acaa">2</span><span class="token plain">没有变，只是删除了</span><span class="token number" style="color:#36acaa">3</span><span class="token plain">，所有最终显示的是</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">key</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token literal-property property" style="color:#36acaa">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">你</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token literal-property property" style="color:#36acaa">key</span><span class="token operator" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token literal-property property" style="color:#36acaa">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain">我</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">，将‘他删除’</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></li></ul></li><li><p>注意: 如果不存在添加/删除/排序操作, 用 index 没有问题</p></li></ul></li><li><p>解决:</p><ul><li>使用 item 数据的标识数据作为 key, 比如 id 属性值</li></ul></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Minyym/my-website/edit/master/docs/react/虚拟DOM.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/my-website/docs/react/hook"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« hook</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/my-website/docs/react/进阶"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">进阶 »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#虚拟dom" class="table-of-contents__link">虚拟DOM</a></li><li><a href="#diff算法" class="table-of-contents__link">diff算法</a><ul><li><a href="#tree-diff" class="table-of-contents__link">tree diff</a></li><li><a href="#component-diff" class="table-of-contents__link">component diff</a></li><li><a href="#element-diff" class="table-of-contents__link">element diff</a></li><li><a href="#总结" class="table-of-contents__link">总结</a></li></ul></li><li><a href="#react-中-keys-的作用是什么" class="table-of-contents__link">React 中 keys 的作用是什么？</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/my-website/assets/js/runtime~main.e0efcf5b.js"></script>
<script src="/my-website/assets/js/main.0b8336bd.js"></script>
</body>
</html>